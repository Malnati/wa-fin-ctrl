<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Gastos Tia Claudia - Relat√≥rios</title>
  <style>
    body { 
      font-family: Arial, sans-serif; 
      margin: 40px; 
      background: #f5f5f5; 
    }
    .container { 
      max-width: 800px; 
      margin: 0 auto; 
      background: white; 
      padding: 30px; 
      border-radius: 10px; 
      box-shadow: 0 2px 10px rgba(0,0,0,0.1); 
    }
    h1 { 
      color: #2c3e50; 
      text-align: center; 
      margin-bottom: 30px; 
    }
    .reports { 
      list-style: none; 
      padding: 0; 
    }
    .reports li { 
      margin: 10px 0; 
    }
    .reports a { 
      display: block; 
      padding: 15px; 
      background: #3498db; 
      color: white; 
      text-decoration: none; 
      border-radius: 5px; 
      transition: background 0.3s; 
    }
    .reports a:hover { 
      background: #2980b9; 
    }
    .info { 
      background: #ecf0f1; 
      padding: 15px; 
      border-radius: 5px; 
      margin-bottom: 20px; 
    }
    .empty { 
      background: #f8d7da; 
      border: 1px solid #f5c6cb; 
      color: #721c24; 
      padding: 15px; 
      border-radius: 5px; 
      margin: 20px 0; 
    }
    .loading { 
      text-align: center; 
      padding: 20px; 
      color: #666; 
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>üìä Relat√≥rios de Gastos</h1>
    <div class="info">
      <strong>Sistema de Presta√ß√£o de Contas</strong><br>
      Relat√≥rios gerados automaticamente a partir dos comprovantes processados.
    </div>
    
    <div id="loading" class="loading">
      üîç Carregando relat√≥rios dispon√≠veis...
    </div>
    
    <ul id="reports-list" class="reports" style="display: none;"></ul>
    
    <div id="empty-state" class="empty" style="display: none;">
      <strong>üì≠ Nenhum relat√≥rio dispon√≠vel</strong><br>
      Execute <code>python app.py processar</code> para gerar os relat√≥rios.
    </div>
    
    <div class="info" style="margin-top: 20px;">
      <strong>‚ÑπÔ∏è Nota:</strong> Este sistema detecta automaticamente os relat√≥rios dispon√≠veis. 
      Para gerar novos relat√≥rios, execute <code>python app.py processar</code> localmente.
      <br><br>
      <strong>üîÑ √öltima verifica√ß√£o:</strong> <span id="last-update"></span>
    </div>
  </div>

  <script>
    // Fun√ß√£o para detectar arquivos HTML dispon√≠veis
    async function detectReports() {
      const reports = [];
      
      // Lista de poss√≠veis arquivos para verificar
      const possibleFiles = [
        'report.html'
      ];
      
      // Gera possibilidades para relat√≥rios mensais dos √∫ltimos 12 meses
      const currentDate = new Date();
      const months = [
        'Janeiro', 'Fevereiro', 'Mar√ßo', 'Abril',
        'Maio', 'Junho', 'Julho', 'Agosto',
        'Setembro', 'Outubro', 'Novembro', 'Dezembro'
      ];
      
      for (let i = 0; i < 12; i++) {
        let testMonth = currentDate.getMonth() - i;
        let testYear = currentDate.getFullYear();
        
        if (testMonth < 0) {
          testMonth += 12;
          testYear -= 1;
        }
        
        const monthStr = (testMonth + 1).toString().padStart(2, '0');
        const monthName = months[testMonth];
        
        // Verifica padr√µes de relat√≥rios mensais (novos e legados para compatibilidade)
        possibleFiles.push(`report-${testYear}-${monthStr}-${monthName}.html`);
        possibleFiles.push(`index-${testYear}-${monthStr}-${monthName}.html`); // Compatibilidade
        possibleFiles.push(`report-${testYear}-${monthStr}-${monthName}-${getCurrentDateString()}.html`);
        possibleFiles.push(`index-${testYear}-${monthStr}-${monthName}-${getCurrentDateString()}.html`); // Compatibilidade
      }
      
      // Testa cada arquivo poss√≠vel
      for (const filename of possibleFiles) {
        if (await fileExists(filename)) {
          reports.push(filename);
        }
      }
      
      return [...new Set(reports)]; // Remove duplicatas
    }
    
    // Fun√ß√£o para verificar se um arquivo existe
    async function fileExists(filename) {
      try {
        const response = await fetch(filename, { method: 'HEAD' });
        return response.ok;
      } catch (e) {
        return false;
      }
    }
    
    // Fun√ß√£o para obter data atual no formato usado nos backups
    function getCurrentDateString() {
      const now = new Date();
      return now.toISOString().slice(0,10).replace(/-/g,'');
    }
    
    // Fun√ß√£o para gerar nome de exibi√ß√£o amig√°vel
    function getDisplayName(filename) {
      if (filename === 'report.html') {
        return 'üìä Relat√≥rio Geral';
      }
      
      // Para relat√≥rios mensais
      const reportMatch = filename.match(/(?:report|index)-(\d{4})-(\d{2})-(.+)\.html/);
      if (reportMatch) {
        const [, year, month, description] = reportMatch;
        const monthNames = {
          '01': 'Janeiro', '02': 'Fevereiro', '03': 'Mar√ßo', '04': 'Abril',
          '05': 'Maio', '06': 'Junho', '07': 'Julho', '08': 'Agosto',
          '09': 'Setembro', '10': 'Outubro', '11': 'Novembro', '12': 'Dezembro'
        };
        const monthName = monthNames[month] || month;
        const hasDate = description.includes('20');
        const isLegacy = filename.startsWith('index-');
        const icon = 'üìÖ';
        return `${icon} ${monthName} ${year}${hasDate ? ` (Backup)` : ''}${isLegacy ? '' : ''}`;
      }
      
      return `üìã ${filename.replace('.html', '')}`;
    }
    
    // Fun√ß√£o para ordenar relat√≥rios
    function sortReports(reports) {
      return reports.sort((a, b) => {
        // report.html sempre primeiro
        if (a === 'report.html') return -1;
        if (b === 'report.html') return 1;
        
        // Relat√≥rios do tipo "report-" antes dos "index-"
        if (a.startsWith('report-') && b.startsWith('index-')) return -1;
        if (a.startsWith('index-') && b.startsWith('report-')) return 1;
        
        // Depois por data (mais recente primeiro)
        return b.localeCompare(a);
      });
    }
    
    // Fun√ß√£o principal para carregar e exibir relat√≥rios
    async function loadReports() {
      try {
        const reports = await detectReports();
        const sortedReports = sortReports(reports);
        
        const loadingDiv = document.getElementById('loading');
        const reportsList = document.getElementById('reports-list');
        const emptyState = document.getElementById('empty-state');
        
        loadingDiv.style.display = 'none';
        
        if (sortedReports.length > 0) {
          // Gera HTML para cada relat√≥rio
          const reportsHtml = sortedReports.map(filename => {
            const displayName = getDisplayName(filename);
            return `<li><a href="${filename}">${displayName}</a></li>`;
          }).join('');
          
          reportsList.innerHTML = reportsHtml;
          reportsList.style.display = 'block';
        } else {
          emptyState.style.display = 'block';
        }
        
        // Atualiza timestamp
        document.getElementById('last-update').textContent = new Date().toLocaleString('pt-BR');
        
      } catch (error) {
        console.error('Erro ao carregar relat√≥rios:', error);
        const loadingDiv = document.getElementById('loading');
        const emptyState = document.getElementById('empty-state');
        
        loadingDiv.style.display = 'none';
        emptyState.style.display = 'block';
        emptyState.innerHTML = `
          <strong>‚ùå Erro ao carregar relat√≥rios</strong><br>
          Verifique se os arquivos est√£o dispon√≠veis e tente recarregar a p√°gina.
        `;
      }
    }
    
    // Carrega relat√≥rios quando a p√°gina √© carregada
    document.addEventListener('DOMContentLoaded', loadReports);
  </script>
</body>
</html> 
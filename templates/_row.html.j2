{# Macro para renderizar uma linha da tabela #}
{% macro render_row(row, loop_index, attrs) %}
<tr class="{{ row.row_class }}" data-row-id="{{ loop_index }}" {% if row.motivo %} data-motivo="{{ row.motivo }}"{% endif %} data-data-hora="{{ row.data_hora }}">
  <td class="data-hora">{{ row.data_hora }}</td>
  <td class="classificacao-cell">
    {% if row.classificacao and row.classificacao != 'nan' %}
      {% if row.classificacao.lower() == 'transfer√™ncia' %}
        <span class="classificacao transferencia edit-field" data-field="classificacao" data-original="{{ row.classificacao }}">{{ row.classificacao }}</span>
      {% elif row.classificacao.lower() == 'pagamento' %}
        <span class="classificacao pagamento edit-field" data-field="classificacao" data-original="{{ row.classificacao }}">{{ row.classificacao }}</span>
      {% else %}
        <span class="classificacao edit-field" data-field="classificacao" data-original="{{ row.classificacao }}">{{ row.classificacao }}</span>
      {% endif %}
    {% else %}
      <span class="classificacao edit-field empty-field" data-field="classificacao" data-original="">Clique para editar</span>
    {% endif %}
  </td>
  <td class="valor-cell">
    {% if row.ricardo and row.ricardo != 'nan' and row.ricardo != '' %}
      <span class="valor edit-field" data-field="ricardo" data-original="{{ row.ricardo }}">{{ row.ricardo }}</span>
    {% else %}
      <span class="valor edit-field empty-field" data-field="ricardo" data-original="">Clique para editar</span>
    {% endif %}
  </td>
  <td class="valor-cell">
    {% if row.rafael and row.rafael != 'nan' and row.rafael != '' %}
      <span class="valor edit-field" data-field="rafael" data-original="{{ row.rafael }}">{{ row.rafael }}</span>
    {% else %}
      <span class="valor edit-field empty-field" data-field="rafael" data-original="">Clique para editar</span>
    {% endif %}
  </td>
  <td>
    {% if row.row_class != 'total-row' and row.anexo and row.anexo != 'nan' and row.anexo != '' %}
      {% if row.anexo.lower().endswith(('.jpg', '.jpeg', '.png')) %}
        <img src="../imgs/{{ row.anexo }}" 
             class="thumb" 
             alt="Comprovante {{ row.anexo }}" 
             title="{{ row.anexo }}">
      {% elif row.anexo.lower().endswith('.pdf') %}
        {% if row.imagem_jpg %}
          <img src="../imgs/{{ row.imagem_jpg }}" 
               class="thumb" 
               alt="Comprovante {{ row.imagem_jpg }}" 
               title="{{ row.imagem_jpg }} (convertido de PDF)">
        {% else %}
          <span class="pdf-icon">üìÑ</span>
        {% endif %}
      {% endif %}
    {% endif %}
  </td>
  <td class="descricao-cell" style="text-align: left; font-size: 12px;">
    {% if row.descricao and row.descricao != 'nan' %}
      <span class="edit-field" data-field="descricao" data-original="{{ row.descricao }}">{{ row.descricao }}</span>
    {% else %}
      <span class="edit-field empty-field" data-field="descricao" data-original="">Clique para editar</span>
    {% endif %}
  </td>
  <td style="text-align: left; font-size: 11px; max-width: 200px; overflow: hidden; text-overflow: ellipsis;">
    {% if row.ocr and row.ocr != 'nan' %}
      {% if row.anexo and row.anexo.lower().endswith('.pdf') %}
        üìÑ 
      {% elif row.anexo and row.anexo.lower().endswith(('.jpg', '.jpeg', '.png')) %}
        üñºÔ∏è 
      {% endif %}
      {{ row.ocr[:100] }}{% if row.ocr|length > 100 %}...{% endif %}
    {% endif %}
  </td>
  {% if tem_motivo %}
  <td style="color:#e67e22;font-size:12px;">
    {% if row.motivo and row.motivo != 'nan' %}
      {{ row.motivo }}
    {% endif %}
  </td>
  {% endif %}
  <td class="actions-cell">
    <div class="row-actions">
      <button class="btn-save" onclick="saveRowChanges('{{ row.data_hora }}')" style="display: none;">üíæ</button>
      <button class="btn-cancel" onclick="cancelRowChanges('{{ row.data_hora }}')" style="display: none;">‚ùå</button>
      <button class="btn-dismiss" onclick="dismissRow('{{ row.data_hora }}')" title="Marcar como desconsiderado">üö´</button>
      <button class="btn-rotate" onclick="rotateImage('{{ row.data_hora }}')" title="Rotacionar imagem" {% if not row.anexo or row.anexo == 'nan' or row.anexo == '' %}disabled{% endif %}>üîÑ</button>
      <button class="btn-reprocess" onclick="reprocessAI('{{ row.data_hora }}')" title="Reprocessar com IA" {% if not row.anexo or row.anexo == 'nan' or row.anexo == '' %}disabled{% endif %}>ü§ñ</button>
    </div>
  </td>
</tr>
{% endmacro %} 
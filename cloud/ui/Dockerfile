# ui/Dockerfile
FROM node:20-alpine AS build

WORKDIR /app

ARG NODE_ENV=production
ENV NODE_ENV=$NODE_ENV

COPY package.json package-lock.json ./
RUN npm ci --include=dev

COPY . .

ARG VITE_API_URL=http://localhost:3333
ARG VITE_DEV_SERVER_PORT=5173
ARG VITE_PREVIEW_ALLOWED_HOSTS=
ARG VITE_HTTPS_PROTOCOL=https:
ARG VITE_COOKIE_PATH_ATTR=path=/
ARG VITE_COOKIE_SAME_SITE_ATTR=samesite=strict
ARG VITE_COOKIE_DELETE_DATE="Thu, 01 Jan 1970 00:00:00 UTC"
ARG VITE_COOKIE_MAX_AGE_MS=86400000
ARG VITE_AUTH_TOKEN_COOKIE_KEY=auth-token
ARG VITE_USER_EMAIL_COOKIE_KEY=userEmail
ARG VITE_USER_NAME_COOKIE_KEY=userName
ARG VITE_USER_PICTURE_COOKIE_KEY=userPicture
ARG VITE_LOCAL_STORAGE_AUTH_TOKEN_KEY=authToken
ARG VITE_LOCAL_STORAGE_USER_EMAIL_KEY=userEmail
ARG VITE_LOCAL_STORAGE_USER_NAME_KEY=userName
ARG VITE_LOCAL_STORAGE_USER_PICTURE_KEY=userPicture
ARG VITE_BYPASS_DEFAULT_TOKEN=bypass-token
ARG VITE_BYPASS_DEFAULT_EMAIL=usuario.demo@yagnostic.local
ARG VITE_BYPASS_DEFAULT_NAME="Usuário Demo"
ARG VITE_UPLOAD_DB_NAME=wl-db
ARG VITE_UPLOAD_DB_VERSION=2
ARG VITE_UPLOAD_FILES_STORE=files
ARG VITE_COMPANY_NAME=MBRA
ARG VITE_COMPANY_LOGO_URL=http://www.mbra.com.br/wp-content/uploads/2023/03/2oQgot9X7fy5fxsnrM9aF24VZ4N.svg
ARG VITE_COMPANY_TITLE="Sistema de Análise de IA"
ARG VITE_COMPANY_DEVELOPED_BY=MBRA
ARG VITE_COMPANY_COPYRIGHT="© 2024 MBRA. Todos os direitos reservados."
ARG VITE_COMPANY_REGISTRATION_DATE=2024-01-01
ARG VITE_COMPANY_CONTACT_EMAIL=contato@mbra.com.br
ARG VITE_COMPANY_CONTACT_PHONE="+55 (61) 3037-6960"
ARG VITE_COMPANY_CONTACT_ADDRESS="SHN QD. 2 BL. F Ed. Executive Office Tower SL. 1114 - Asa Norte, Brasília-DF CEP 70702-906"
ARG VITE_COMPANY_WEBSITE=http://www.mbra.com.br
ARG VITE_COMPANY_FACEBOOK=http://facebook.com/mbra
ARG VITE_COMPANY_TWITTER=http://twitter.com/mbra
ARG VITE_COMPANY_GOOGLE=http://google.com/mbra
ARG VITE_COMPANY_INSTAGRAM=http://instagram.com/mbra
ARG VITE_COMPANY_LINKEDIN=http://linkedin.com/company/mbra
ARG VITE_COMPANY_GITHUB=http://github.com/mbra
ARG VITE_WL_COMPANY_NAME="Sua Empresa"
ARG VITE_WL_COMPANY_LOGO_URL=/assets/logo.svg
ARG VITE_WL_COMPANY_TITLE="Sistema de Análise de IA"
ARG VITE_WL_COMPANY_DEVELOPED_BY="Sua Empresa"
ARG VITE_WL_COMPANY_COPYRIGHT="© 2024 Sua Empresa. Todos os direitos reservados."
ARG VITE_WL_COMPANY_REGISTRATION_DATE=2024-01-01
ARG VITE_WL_COMPANY_CONTACT_EMAIL=contato@suaempresa.com.br
ARG VITE_WL_COMPANY_CONTACT_PHONE="+55 (61) 3037-6960"
ARG VITE_WL_COMPANY_CONTACT_ADDRESS="SHN QD. 2 BL. F Ed. Executive Office Tower SL. 1114 - Asa Norte, Brasília-DF CEP 70702-906"
ARG VITE_WL_COMPANY_WEBSITE=http://www.empresa.com.br
ARG VITE_WL_COMPANY_FACEBOOK=http://facebook.com/suaempresa
ARG VITE_WL_COMPANY_TWITTER=http://twitter.com/suaempresa
ARG VITE_WL_COMPANY_GOOGLE=http://google.com/suaempresa
ARG VITE_WL_COMPANY_INSTAGRAM=http://instagram.com/suaempresa
ARG VITE_WL_COMPANY_LINKEDIN=http://linkedin.com/company/suaempresa
ARG VITE_WL_COMPANY_GITHUB=http://github.com/suaempresa
ARG VITE_CONSENT_STORAGE_KEY=yagnostic-lgpd-consent
ARG VITE_ONBOARDING_STORAGE_KEY=yagnostic-onboarding-progress
ARG VITE_CONSENT_VERSION=1.0.0
ARG VITE_FILE_HISTORY_DEFAULT_TITLE="Histórico de Arquivos"
ARG VITE_FILE_HISTORY_ITEMS_PER_PAGE=10
ARG VITE_FILE_HISTORY_MAX_PAGINATION_BUTTONS=5
ARG VITE_AVATAR_PLACEHOLDER_URL=https://via.placeholder.com/32

ENV \
  VITE_API_URL=$VITE_API_URL \
  VITE_DEV_SERVER_PORT=$VITE_DEV_SERVER_PORT \
  VITE_PREVIEW_ALLOWED_HOSTS=$VITE_PREVIEW_ALLOWED_HOSTS \
  VITE_HTTPS_PROTOCOL=$VITE_HTTPS_PROTOCOL \
  VITE_COOKIE_PATH_ATTR=$VITE_COOKIE_PATH_ATTR \
  VITE_COOKIE_SAME_SITE_ATTR=$VITE_COOKIE_SAME_SITE_ATTR \
  VITE_COOKIE_DELETE_DATE=$VITE_COOKIE_DELETE_DATE \
  VITE_COOKIE_MAX_AGE_MS=$VITE_COOKIE_MAX_AGE_MS \
  VITE_AUTH_TOKEN_COOKIE_KEY=$VITE_AUTH_TOKEN_COOKIE_KEY \
  VITE_USER_EMAIL_COOKIE_KEY=$VITE_USER_EMAIL_COOKIE_KEY \
  VITE_USER_NAME_COOKIE_KEY=$VITE_USER_NAME_COOKIE_KEY \
  VITE_USER_PICTURE_COOKIE_KEY=$VITE_USER_PICTURE_COOKIE_KEY \
  VITE_LOCAL_STORAGE_AUTH_TOKEN_KEY=$VITE_LOCAL_STORAGE_AUTH_TOKEN_KEY \
  VITE_LOCAL_STORAGE_USER_EMAIL_KEY=$VITE_LOCAL_STORAGE_USER_EMAIL_KEY \
  VITE_LOCAL_STORAGE_USER_NAME_KEY=$VITE_LOCAL_STORAGE_USER_NAME_KEY \
  VITE_LOCAL_STORAGE_USER_PICTURE_KEY=$VITE_LOCAL_STORAGE_USER_PICTURE_KEY \
  VITE_BYPASS_DEFAULT_TOKEN=$VITE_BYPASS_DEFAULT_TOKEN \
  VITE_BYPASS_DEFAULT_EMAIL=$VITE_BYPASS_DEFAULT_EMAIL \
  VITE_BYPASS_DEFAULT_NAME=$VITE_BYPASS_DEFAULT_NAME \
  VITE_UPLOAD_DB_NAME=$VITE_UPLOAD_DB_NAME \
  VITE_UPLOAD_DB_VERSION=$VITE_UPLOAD_DB_VERSION \
  VITE_UPLOAD_FILES_STORE=$VITE_UPLOAD_FILES_STORE \
  VITE_COMPANY_NAME=$VITE_COMPANY_NAME \
  VITE_COMPANY_LOGO_URL=$VITE_COMPANY_LOGO_URL \
  VITE_COMPANY_TITLE=$VITE_COMPANY_TITLE \
  VITE_COMPANY_DEVELOPED_BY=$VITE_COMPANY_DEVELOPED_BY \
  VITE_COMPANY_COPYRIGHT=$VITE_COMPANY_COPYRIGHT \
  VITE_COMPANY_REGISTRATION_DATE=$VITE_COMPANY_REGISTRATION_DATE \
  VITE_COMPANY_CONTACT_EMAIL=$VITE_COMPANY_CONTACT_EMAIL \
  VITE_COMPANY_CONTACT_PHONE=$VITE_COMPANY_CONTACT_PHONE \
  VITE_COMPANY_CONTACT_ADDRESS=$VITE_COMPANY_CONTACT_ADDRESS \
  VITE_COMPANY_WEBSITE=$VITE_COMPANY_WEBSITE \
  VITE_COMPANY_FACEBOOK=$VITE_COMPANY_FACEBOOK \
  VITE_COMPANY_TWITTER=$VITE_COMPANY_TWITTER \
  VITE_COMPANY_GOOGLE=$VITE_COMPANY_GOOGLE \
  VITE_COMPANY_INSTAGRAM=$VITE_COMPANY_INSTAGRAM \
  VITE_COMPANY_LINKEDIN=$VITE_COMPANY_LINKEDIN \
  VITE_COMPANY_GITHUB=$VITE_COMPANY_GITHUB \
  VITE_WL_COMPANY_NAME=$VITE_WL_COMPANY_NAME \
  VITE_WL_COMPANY_LOGO_URL=$VITE_WL_COMPANY_LOGO_URL \
  VITE_WL_COMPANY_TITLE=$VITE_WL_COMPANY_TITLE \
  VITE_WL_COMPANY_DEVELOPED_BY=$VITE_WL_COMPANY_DEVELOPED_BY \
  VITE_WL_COMPANY_COPYRIGHT=$VITE_WL_COMPANY_COPYRIGHT \
  VITE_WL_COMPANY_REGISTRATION_DATE=$VITE_WL_COMPANY_REGISTRATION_DATE \
  VITE_WL_COMPANY_CONTACT_EMAIL=$VITE_WL_COMPANY_CONTACT_EMAIL \
  VITE_WL_COMPANY_CONTACT_PHONE=$VITE_WL_COMPANY_CONTACT_PHONE \
  VITE_WL_COMPANY_CONTACT_ADDRESS=$VITE_WL_COMPANY_CONTACT_ADDRESS \
  VITE_WL_COMPANY_WEBSITE=$VITE_WL_COMPANY_WEBSITE \
  VITE_WL_COMPANY_FACEBOOK=$VITE_WL_COMPANY_FACEBOOK \
  VITE_WL_COMPANY_TWITTER=$VITE_WL_COMPANY_TWITTER \
  VITE_WL_COMPANY_GOOGLE=$VITE_WL_COMPANY_GOOGLE \
  VITE_WL_COMPANY_INSTAGRAM=$VITE_WL_COMPANY_INSTAGRAM \
  VITE_WL_COMPANY_LINKEDIN=$VITE_WL_COMPANY_LINKEDIN \
  VITE_WL_COMPANY_GITHUB=$VITE_WL_COMPANY_GITHUB \
  VITE_CONSENT_STORAGE_KEY=$VITE_CONSENT_STORAGE_KEY \
  VITE_ONBOARDING_STORAGE_KEY=$VITE_ONBOARDING_STORAGE_KEY \
  VITE_CONSENT_VERSION=$VITE_CONSENT_VERSION \
  VITE_FILE_HISTORY_DEFAULT_TITLE=$VITE_FILE_HISTORY_DEFAULT_TITLE \
  VITE_FILE_HISTORY_ITEMS_PER_PAGE=$VITE_FILE_HISTORY_ITEMS_PER_PAGE \
  VITE_FILE_HISTORY_MAX_PAGINATION_BUTTONS=$VITE_FILE_HISTORY_MAX_PAGINATION_BUTTONS \
  VITE_AVATAR_PLACEHOLDER_URL=$VITE_AVATAR_PLACEHOLDER_URL

RUN npm run build

FROM nginx:1.27-alpine AS runtime

COPY nginx/default.conf /etc/nginx/conf.d/default.conf
COPY --from=build /app/dist /usr/share/nginx/html
COPY entrypoint.sh /entrypoint.sh
RUN chmod +x /entrypoint.sh

EXPOSE 80

ENTRYPOINT ["/entrypoint.sh"]
CMD ["nginx", "-g", "daemon off;"]

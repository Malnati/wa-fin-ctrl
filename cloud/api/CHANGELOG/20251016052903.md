<!-- CHANGELOG/20251016052903.md -->
# 2025-10-16 05:29 UTC — Ajustar URLs públicas do diagnóstico

## Arquivos modificados
- src/diagnostics/diagnostics.controller.ts
- src/diagnostics/diagnostics.controller.spec.ts
- src/diagnostics/diagnostics.service.ts
- src/diagnostics/diagnostics.service.spec.ts
- src/diagnostics/pdf-generator.service.ts
- src/diagnostics/pdf-generator.service.spec.ts

## Regras e requisitos atendidos
- Construção das URLs agora utiliza o domínio da requisição HTTP quando disponível, mantendo `BASE_URL` como fallback, eliminando o uso indevido de `http://localhost:3333` em produção.
- Ajustes propagados para geração de PDF e salvamento do arquivo original garantindo consistência entre links retornados ao cliente.
- Cobertura de testes atualizada para refletir o novo fluxo dinâmico, incluindo cenários com cabeçalhos `X-Forwarded-*` e validações das opções de base URL.

## Pendências e próximos passos
- Monitorar em produção se proxies adicionais exigem suporte a outros cabeçalhos padrão (ex.: `Forwarded`) para derivar corretamente a URL pública.
